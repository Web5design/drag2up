<script>
function params(obj){
  var str = [];
  for(var i in obj) str.push(i+'='+encodeURIComponent(obj[i]));
  return str.join('&');
}
chrome.extension.onRequest.addListener(function(request, sender, sendResponse) {
  console.log(request)
  var xhr = new XMLHttpRequest();
  xhr.open('GET','http://drag2up.appspot.com/new?'+params({
    host: request.host,
    size: request.size,
    name: request.name
  }), true);
  xhr.onload = function(){
    var parts = xhr.responseText.split(',');
    sendResponse({
      callback: request.callback,
      url: parts[0],
      code: parts[1]
    })
  }
  xhr.send();
});

</script>
